<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B1 Homework - Session 9: Commuting and Transportation</title>
    <style>*{margin:0;padding:0;box-sizing:border-box}body{font-family:'Segoe UI',sans-serif;background:#5B5091;min-height:100vh;padding:20px}.container{max-width:800px;margin:0 auto}.header{background:#fff;border-radius:20px;padding:30px;margin-bottom:20px;text-align:center;box-shadow:0 10px 40px rgba(0,0,0,.2)}.header h1{color:#5B5091;font-size:1.4em}.header p{color:#888}.student-info{background:#fff;border-radius:16px;padding:25px;margin-bottom:20px}.student-info label{font-weight:600;color:#333;display:block;margin-bottom:8px}.student-info input,.student-info select{width:100%;padding:14px;border:2px solid #e0e0e0;border-radius:12px;font-size:16px;margin-bottom:15px}.student-info input:focus,.student-info select:focus{outline:none;border-color:#5B5091}.progress-bar{background:#fff;border-radius:16px;padding:15px 20px;margin-bottom:20px}.progress-track{height:8px;background:#e0e0e0;border-radius:4px;overflow:hidden}.progress-fill{height:100%;background:#F5A623;transition:width .5s}.progress-text{display:flex;justify-content:space-between;margin-top:8px;font-size:14px;color:#666}.section{background:#fff;border-radius:20px;padding:30px;margin-bottom:20px;display:none}.section.active{display:block}.section-header{display:flex;align-items:center;gap:15px;margin-bottom:25px;padding-bottom:20px;border-bottom:1px solid #eee}.section-icon{width:48px;height:48px;border-radius:12px;display:flex;align-items:center;justify-content:center;border:2px solid #5B5091}.section-icon svg{width:24px;height:24px;stroke:#5B5091;stroke-width:2;fill:none}.section-title h2{color:#333;font-size:1.2em}.section-title p{color:#888;font-size:.9em}.btn{background:#5B5091;color:#fff;border:none;padding:14px 32px;border-radius:12px;font-size:16px;font-weight:600;cursor:pointer;transition:all .2s}.btn:hover{background:#4a4080}.btn:disabled{opacity:.5}.btn-secondary{background:#f5f5f5;color:#333}.btn-secondary:hover{background:#eee}.btn-submit{background:#F5A623}.question-card{background:#f8f9fa;border-radius:12px;padding:20px;margin:15px 0;border:1px solid #eee}.question-card h4{margin-bottom:15px;color:#333}.options{display:flex;flex-direction:column;gap:10px}.option{padding:14px 16px;border:2px solid #e0e0e0;border-radius:10px;cursor:pointer;display:flex;align-items:center;gap:12px}.option:hover{border-color:#5B5091;background:#f8f6ff}.option.selected{border-color:#5B5091;background:#f0edff}.option.correct{border-color:#22c55e;background:#f0fdf4}.option.incorrect{border-color:#ef4444;background:#fef2f2}.option span{width:20px;height:20px;border:2px solid #ccc;border-radius:50%}.option.selected span{border-color:#5B5091;background:#5B5091}.writing-area{width:100%;min-height:150px;padding:16px;border:2px solid #e0e0e0;border-radius:12px;font-size:16px;resize:vertical;font-family:inherit}.writing-area:focus{outline:none;border-color:#5B5091}.word-count{text-align:right;color:#888;font-size:14px;margin-top:8px}.feedback-box{background:#f8f6ff;border:1px solid #5B5091;border-radius:12px;padding:20px;margin-top:15px;display:none}.feedback-box.visible{display:block}.feedback-box h4{color:#5B5091;margin-bottom:10px}.record-btn{width:80px;height:80px;border-radius:50%;background:#fff;border:3px solid #5B5091;cursor:pointer;display:flex;align-items:center;justify-content:center;margin:20px auto}.record-btn:hover{background:#f8f6ff}.record-btn.recording{border-color:#ef4444;background:#fef2f2;animation:pulse 1.5s infinite}@keyframes pulse{0%,100%{box-shadow:0 0 0 0 rgba(239,68,68,.4)}50%{box-shadow:0 0 0 15px rgba(239,68,68,0)}}.record-icon{width:24px;height:24px;background:#5B5091;border-radius:50%}.record-btn.recording .record-icon{border-radius:4px;width:20px;height:20px;background:#ef4444}.recording-status{text-align:center;margin-top:15px;color:#666}.audio-playback{margin-top:20px;display:none}.audio-playback.visible{display:block}.score-card{background:linear-gradient(135deg,#5B5091,#7B6DB5);border-radius:20px;padding:35px;color:#fff;text-align:center}.final-score{font-size:4em;font-weight:700}.score-breakdown{display:grid;grid-template-columns:repeat(5,1fr);gap:10px;margin-top:25px}.score-item{background:rgba(255,255,255,.15);border-radius:12px;padding:12px 8px}.score-item-label{font-size:.75em;opacity:.9}.score-item-value{font-size:1.4em;font-weight:700}.drag-container{display:flex;flex-wrap:wrap;gap:10px;padding:15px;background:#f5f5f5;border-radius:12px;margin-bottom:15px}.drag-item{background:#fff;padding:12px 18px;border-radius:8px;cursor:pointer;border:2px solid #e0e0e0}.drag-item:hover{border-color:#5B5091}.drag-item.selected{border-color:#5B5091;background:#f0edff}.drop-target{min-width:120px;min-height:48px;border:2px dashed #ccc;border-radius:8px;padding:12px;display:flex;align-items:center;justify-content:center;color:#999;cursor:pointer}.drop-target.filled{border-style:solid;border-color:#5B5091;background:#f8f6ff;color:#333}.match-row{display:grid;grid-template-columns:1fr auto 1fr;gap:15px;align-items:center;margin-bottom:12px}.match-definition{background:#f8f9fa;padding:14px;border-radius:8px;border:1px solid #eee}.loading{display:none;align-items:center;justify-content:center;gap:10px;padding:20px}.loading.visible{display:flex}.spinner{width:24px;height:24px;border:3px solid #e0e0e0;border-top-color:#5B5091;border-radius:50%;animation:spin 1s linear infinite}@keyframes spin{to{transform:rotate(360deg)}}.nav-buttons{display:flex;justify-content:space-between;margin-top:25px}.prompt-box{background:#f8f6ff;border:1px solid #d4d0e8;border-radius:12px;padding:20px;margin-bottom:20px}.prompt-box h4{color:#5B5091;margin-bottom:10px}.tips-list{margin-top:12px;padding-left:20px}.tips-list li{color:#666;margin-bottom:6px}.submit-section{margin-top:30px;padding-top:25px;border-top:1px solid rgba(255,255,255,.2);text-align:center}.transcript-box{background:#e8f5e9;border:1px solid #a5d6a7;border-radius:8px;padding:15px;margin-top:15px;display:none;font-style:italic;color:#2e7d32}.transcript-box.visible{display:block}.not-submitted{background:#ffebee;border:2px solid #ef5350;border-radius:12px;padding:20px;text-align:center;animation:pulse-warning 2s infinite}.not-submitted h3{color:#c62828;margin-bottom:10px}@keyframes pulse-warning{0%,100%{box-shadow:0 0 0 0 rgba(239,83,80,.4)}50%{box-shadow:0 0 0 10px rgba(239,83,80,0)}}.submitted-success{background:#e8f5e9;border:2px solid #66bb6a;border-radius:12px;padding:20px;text-align:center;display:none}.submitted-success h3{color:#2e7d32}@media(max-width:600px){.match-row{grid-template-columns:1fr}.score-breakdown{grid-template-columns:repeat(3,1fr)}}</style>
</head>
<body>
<div class="container">
    <div class="header"><h1>üöå Session 9: Commuting and Transportation</h1><p>Week 5 ‚Ä¢ Transportation Vocabulary & Opinions</p></div>
    <div class="student-info" id="studentInfoSection"><label>Your Full Name</label><input type="text" id="studentName" placeholder="Enter your name..."><label>Your Class</label><select id="studentClass"><option value="">Select your class...</option><option value="3072-MW-11AM">3072 - Mon/Wed 11:00 AM</option><option value="3074-MW-8PM">3074 - Mon/Wed 8:00 PM</option><option value="3080-TTH-11AM">3080 - Tue/Thu 11:00 AM</option><option value="3082-TTH-8PM">3082 - Tue/Thu 8:00 PM</option><option value="3085-TTH-945PM">3085 - Tue/Thu 9:45 PM</option></select><button class="btn" style="width:100%" onclick="startHomework()">Start Homework ‚Üí</button></div>
    <div class="progress-bar" id="progressBar" style="display:none"><div class="progress-track"><div class="progress-fill" id="progressFill" style="width:0"></div></div><div class="progress-text"><span id="progressLabel">Section 1 of 5</span><span id="progressPercent">0%</span></div></div>
    
    <div class="section" id="section1">
        <div class="section-header"><div class="section-icon"><svg viewBox="0 0 24 24"><path d="M3 18v-6a9 9 0 0 1 18 0v6"/><path d="M21 19a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3zM3 19a2 2 0 0 0 2 2h1a2 2 0 0 0 2-2v-3a2 2 0 0 0-2-2H3z"/></svg></div><div class="section-title"><h2>1. Listening</h2><p>Sofia and Ahmed discussing their commutes</p></div></div>
        <div class="prompt-box"><h4>üéß Listen to the dialogue</h4><p>Sofia and Ahmed are talking about how they get to work.</p></div>
        <div style="margin-bottom:20px;display:flex;gap:10px;flex-wrap:wrap"><button class="btn" id="playAudioBtn" onclick="playListening()">‚ñ∂ Play Audio</button><button class="btn btn-secondary" onclick="stopListening()">‚óº Stop</button><button class="btn btn-secondary" onclick="document.getElementById('transcript').style.display='block'">Show Transcript</button></div>
        <div id="transcript" style="display:none;background:#f5f5f5;padding:15px;border-radius:8px;margin-bottom:20px;font-size:14px"><p><strong>Sofia:</strong> Hello Ahmed! How do you get to work?</p><p><strong>Ahmed:</strong> I take the subway. It takes about 45 minutes. How about you?</p><p><strong>Sofia:</strong> I drive to the train station, then take the train. It's about an hour total.</p><p><strong>Ahmed:</strong> Have you tried the bus?</p><p><strong>Sofia:</strong> No, buses are too infrequent. I tried biking once, but it wasn't safe.</p><p><strong>Ahmed:</strong> I tried different options, but the subway is most reliable. I can read or listen to podcasts.</p><p><strong>Sofia:</strong> Maybe I'll try your subway route sometime.</p></div>
        <div class="question-card"><h4>1. How does Ahmed get to work?</h4><div class="options" data-c="b"><div class="option" onclick="sel(this)" data-v="a"><span></span>He drives his car</div><div class="option" onclick="sel(this)" data-v="b"><span></span>He takes the subway</div><div class="option" onclick="sel(this)" data-v="c"><span></span>He takes the bus</div></div></div>
        <div class="question-card"><h4>2. How long is Sofia's commute?</h4><div class="options" data-c="c"><div class="option" onclick="sel(this)" data-v="a"><span></span>30 minutes</div><div class="option" onclick="sel(this)" data-v="b"><span></span>45 minutes</div><div class="option" onclick="sel(this)" data-v="c"><span></span>About an hour</div></div></div>
        <div class="question-card"><h4>3. Why doesn't Sofia take the bus?</h4><div class="options" data-c="a"><div class="option" onclick="sel(this)" data-v="a"><span></span>Buses are too infrequent</div><div class="option" onclick="sel(this)" data-v="b"><span></span>Buses are too expensive</div><div class="option" onclick="sel(this)" data-v="c"><span></span>Buses are too slow</div></div></div>
        <div class="nav-buttons"><button class="btn btn-secondary" onclick="goBack0()">‚Üê Back</button><button class="btn" onclick="submitS1()">Continue ‚Üí</button></div>
    </div>

    <div class="section" id="section2">
        <div class="section-header"><div class="section-icon"><svg viewBox="0 0 24 24"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></svg></div><div class="section-title"><h2>2. Vocabulary</h2><p>Match transportation verbs</p></div></div>
        <p style="margin-bottom:15px;color:#666">Click a phrase, then click where it belongs:</p>
        <div class="drag-container" id="wordBank"><div class="drag-item" onclick="pickWord(this)" data-w="take the bus">take the bus</div><div class="drag-item" onclick="pickWord(this)" data-w="miss the train">miss the train</div><div class="drag-item" onclick="pickWord(this)" data-w="get stuck in traffic">get stuck in traffic</div><div class="drag-item" onclick="pickWord(this)" data-w="carpool">carpool</div><div class="drag-item" onclick="pickWord(this)" data-w="ride a bicycle">ride a bicycle</div><div class="drag-item" onclick="pickWord(this)" data-w="call a taxi">call a taxi</div></div>
        <div><div class="match-row"><div class="match-definition">Use public transportation</div><div>‚Üí</div><div class="drop-target" data-a="take the bus" onclick="dropWord(this)"></div></div><div class="match-row"><div class="match-definition">Arrive too late for your train</div><div>‚Üí</div><div class="drop-target" data-a="miss the train" onclick="dropWord(this)"></div></div><div class="match-row"><div class="match-definition">Be delayed because of many cars</div><div>‚Üí</div><div class="drop-target" data-a="get stuck in traffic" onclick="dropWord(this)"></div></div><div class="match-row"><div class="match-definition">Share a car with colleagues</div><div>‚Üí</div><div class="drop-target" data-a="carpool" onclick="dropWord(this)"></div></div><div class="match-row"><div class="match-definition">Use a two-wheel vehicle with pedals</div><div>‚Üí</div><div class="drop-target" data-a="ride a bicycle" onclick="dropWord(this)"></div></div><div class="match-row"><div class="match-definition">Request a car service</div><div>‚Üí</div><div class="drop-target" data-a="call a taxi" onclick="dropWord(this)"></div></div></div>
        <div class="nav-buttons"><button class="btn btn-secondary" onclick="goTo(1)">‚Üê Back</button><button class="btn" onclick="submitS2()">Continue ‚Üí</button></div>
    </div>

    <div class="section" id="section3">
        <div class="section-header"><div class="section-icon"><svg viewBox="0 0 24 24"><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/><path d="m15 5 4 4"/></svg></div><div class="section-title"><h2>3. Writing</h2><p>Describe your typical commute</p></div></div>
        <div class="prompt-box"><h4>‚úçÔ∏è Writing Task</h4><p>Write a short paragraph about your typical commute by answering these questions:</p><ul class="tips-list"><li>What transportation do you use?</li><li>Where do you usually go?</li><li>What do you like about your commute?</li><li>What do you dislike about it?</li><li>What is your opinion of transportation in your town?</li></ul><p style="margin-top:10px"><strong>Use opinion phrases:</strong> I think..., I believe..., In my opinion..., I prefer...</p></div>
        <textarea class="writing-area" id="writingResponse" placeholder="My typical commute is about 30 minutes. I usually take the bus to work. I think the bus is reliable because..." oninput="updateWC()"></textarea>
        <div class="word-count">Words: <span id="wordCount">0</span></div>
        <div class="loading" id="writingLoading"><div class="spinner"></div><span>Checking...</span></div>
        <div class="feedback-box" id="writingFeedback"></div>
        <div class="nav-buttons"><button class="btn btn-secondary" onclick="goTo(2)">‚Üê Back</button><button class="btn" id="writingSubmitBtn" onclick="submitWriting()">Get Feedback ‚Üí</button><button class="btn" id="writingContinueBtn" onclick="goTo(4)" style="display:none">Continue ‚Üí</button></div>
    </div>

    <div class="section" id="section4">
        <div class="section-header"><div class="section-icon"><svg viewBox="0 0 24 24"><path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" x2="12" y1="19" y2="22"/></svg></div><div class="section-title"><h2>4. Speaking</h2><p>Talk about your commute</p></div></div>
        <div class="prompt-box"><h4>üé§ Speaking Task</h4><p>Record yourself answering:</p><ul class="tips-list"><li>How do you get to work or school?</li><li>How long is your commute?</li><li>Do you prefer public or private transportation? Why?</li></ul></div>
        <button class="record-btn" id="recordBtn" onclick="toggleRec()"><div class="record-icon"></div></button>
        <div class="recording-status"><span id="recordingStatus">Click to start recording</span><div id="recordingTimer" style="font-size:24px;font-weight:bold;margin-top:10px">0:00</div></div>
        <div class="audio-playback" id="audioPlayback"><audio id="recordedAudio" controls style="width:100%"></audio></div>
        <div id="transcriptBox" class="transcript-box"></div>
        <div class="loading" id="speakingLoading"><div class="spinner"></div><span>Processing...</span></div>
        <div class="feedback-box" id="speakingFeedback"></div>
        <div class="nav-buttons"><button class="btn btn-secondary" onclick="goTo(3)">‚Üê Back</button><button class="btn" id="submitSpeakingBtn" onclick="submitSpeaking()" disabled>Continue ‚Üí</button></div>
    </div>

    <div class="section" id="section5">
        <div class="section-header"><div class="section-icon"><svg viewBox="0 0 24 24"><polyline points="9 11 12 14 22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/></svg></div><div class="section-title"><h2>5. Grammar Quiz</h2><p>Transportation vocabulary & opinions</p></div></div>
        <div class="question-card"><h4>1. I _____ the subway to work every day.</h4><div class="options" data-c="a"><div class="option" onclick="sel(this)" data-v="a"><span></span>take</div><div class="option" onclick="sel(this)" data-v="b"><span></span>drive</div><div class="option" onclick="sel(this)" data-v="c"><span></span>ride</div></div></div>
        <div class="question-card"><h4>2. I was late because I _____ the bus.</h4><div class="options" data-c="b"><div class="option" onclick="sel(this)" data-v="a"><span></span>lost</div><div class="option" onclick="sel(this)" data-v="b"><span></span>missed</div><div class="option" onclick="sel(this)" data-v="c"><span></span>forgot</div></div></div>
        <div class="question-card"><h4>3. We _____ in traffic for an hour yesterday.</h4><div class="options" data-c="c"><div class="option" onclick="sel(this)" data-v="a"><span></span>stayed stuck</div><div class="option" onclick="sel(this)" data-v="b"><span></span>were getting</div><div class="option" onclick="sel(this)" data-v="c"><span></span>got stuck</div></div></div>
        <div class="question-card"><h4>4. _____, public transportation is better for the environment.</h4><div class="options" data-c="b"><div class="option" onclick="sel(this)" data-v="a"><span></span>I prefer</div><div class="option" onclick="sel(this)" data-v="b"><span></span>In my opinion</div><div class="option" onclick="sel(this)" data-v="c"><span></span>I like</div></div></div>
        <div class="question-card"><h4>5. She _____ to work with her colleagues to save money.</h4><div class="options" data-c="a"><div class="option" onclick="sel(this)" data-v="a"><span></span>carpools</div><div class="option" onclick="sel(this)" data-v="b"><span></span>drives alone</div><div class="option" onclick="sel(this)" data-v="c"><span></span>walks</div></div></div>
        <div class="question-card"><h4>6. How long _____ your daily commute?</h4><div class="options" data-c="b"><div class="option" onclick="sel(this)" data-v="a"><span></span>does</div><div class="option" onclick="sel(this)" data-v="b"><span></span>is</div><div class="option" onclick="sel(this)" data-v="c"><span></span>takes</div></div></div>
        <div class="question-card"><h4>7. I _____ biking is dangerous in the city.</h4><div class="options" data-c="a"><div class="option" onclick="sel(this)" data-v="a"><span></span>think</div><div class="option" onclick="sel(this)" data-v="b"><span></span>opinion</div><div class="option" onclick="sel(this)" data-v="c"><span></span>prefer</div></div></div>
        <div class="question-card"><h4>8. Can you _____ a taxi for me?</h4><div class="options" data-c="c"><div class="option" onclick="sel(this)" data-v="a"><span></span>take</div><div class="option" onclick="sel(this)" data-v="b"><span></span>ride</div><div class="option" onclick="sel(this)" data-v="c"><span></span>call</div></div></div>
        <div class="nav-buttons"><button class="btn btn-secondary" onclick="goTo(4)">‚Üê Back</button><button class="btn btn-submit" onclick="submitFinal()">Submit Homework ‚úì</button></div>
    </div>

    <div class="section" id="scoreSection">
        <div class="score-card"><h2 style="margin-bottom:10px">üéâ Great job, <span id="scoreName"></span>!</h2><div class="final-score" id="finalScore">0%</div><p style="opacity:.9;margin-top:10px">Session 9 Complete</p><div class="score-breakdown"><div class="score-item"><div class="score-item-label">Listening</div><div class="score-item-value" id="listeningScore">0/3</div></div><div class="score-item"><div class="score-item-label">Vocab</div><div class="score-item-value" id="vocabScore">0/6</div></div><div class="score-item"><div class="score-item-label">Writing</div><div class="score-item-value" id="writingScore">0/20</div></div><div class="score-item"><div class="score-item-label">Speaking</div><div class="score-item-value" id="speakingScore">0/20</div></div><div class="score-item"><div class="score-item-label">Grammar</div><div class="score-item-value" id="grammarScore">0/8</div></div></div>
            <div class="submit-section" id="nameClassSection"><div class="not-submitted" id="notSubmittedWarning"><h3>‚ö†Ô∏è NOT YET SUBMITTED</h3><p>Click the button below to submit your homework</p></div><div class="submitted-success" id="submittedSuccess"><h3>‚úì Submitted Successfully!</h3><p>Your teacher will receive your homework</p></div><button class="btn" id="submitBtn" onclick="submitToTeacher()" style="margin-top:20px;padding:24px 48px;font-size:22px;animation:pulse-warning 2s infinite">üì§ Submit to Teacher</button></div>
        </div>
    </div>
</div>

<script>
const SESSION='Session 9';let sn='',sc={l:0,v:0,w:0,s:0,g:0},cs=1,selectedWord=null;let voices=[],isSpeaking=false;let mr,ac,isRec=false,rs=0,ri;let speechTranscript='';
const listeningScript=[{speaker:'Sofia',text:'Hello Ahmed! How do you get to work?'},{speaker:'Ahmed',text:'I take the subway. It takes about 45 minutes. How about you?'},{speaker:'Sofia',text:"I drive to the train station, then take the train. It's about an hour total."},{speaker:'Ahmed',text:'Have you tried the bus?'},{speaker:'Sofia',text:"No, buses are too infrequent. I tried biking once, but it wasn't safe."},{speaker:'Ahmed',text:'I tried different options, but the subway is most reliable. I can read or listen to podcasts.'},{speaker:'Sofia',text:"Maybe I'll try your subway route sometime."}];
function loadVoices(){voices=speechSynthesis.getVoices()}speechSynthesis.onvoiceschanged=loadVoices;loadVoices();
function getBestVoice(g){const d=['Google','Microsoft','Samantha','Daniel'];let best=null,bs=0;for(const v of voices){if(!v.lang.startsWith('en'))continue;let s=0;for(const x of d){if(v.name.includes(x))s+=10}if(v.lang==='en-US')s+=5;if(g==='f'&&(v.name.includes('Samantha')||v.name.includes('Female')))s+=8;if(g==='m'&&(v.name.includes('Daniel')||v.name.includes('Male')))s+=8;if(s>bs){bs=s;best=v}}return best||voices[0]}
function playListening(){if(isSpeaking)return;isSpeaking=true;document.getElementById('playAudioBtn').textContent='Playing...';document.getElementById('playAudioBtn').disabled=true;let i=0;function next(){if(i>=listeningScript.length||!isSpeaking){isSpeaking=false;document.getElementById('playAudioBtn').textContent='‚ñ∂ Play Again';document.getElementById('playAudioBtn').disabled=false;return}const l=listeningScript[i];const u=new SpeechSynthesisUtterance(l.text);u.voice=getBestVoice(l.speaker==='Sofia'?'f':'m');u.rate=0.85;u.pitch=l.speaker==='Sofia'?1.05:0.95;u.onend=()=>{i++;setTimeout(next,600)};u.onerror=()=>{i++;setTimeout(next,300)};speechSynthesis.speak(u)}speechSynthesis.cancel();setTimeout(next,100)}
function stopListening(){speechSynthesis.cancel();isSpeaking=false;document.getElementById('playAudioBtn').textContent='‚ñ∂ Play Audio';document.getElementById('playAudioBtn').disabled=false}
function startHomework(){const n=document.getElementById('studentName').value.trim();const c=document.getElementById('studentClass').value;if(!n){alert('Please enter your name');return}if(!c){alert('Please select your class');return}sn=n+' ['+c+']';document.getElementById('studentInfoSection').style.display='none';document.getElementById('progressBar').style.display='block';goTo(1)}
function goBack0(){document.getElementById('section1').classList.remove('active');document.getElementById('studentInfoSection').style.display='block';document.getElementById('progressBar').style.display='none'}
function goTo(s){cs=s;document.querySelectorAll('.section').forEach(x=>x.classList.remove('active'));document.getElementById('section'+s).classList.add('active');const p=(s/5)*100;document.getElementById('progressFill').style.width=p+'%';document.getElementById('progressLabel').textContent='Section '+s+' of 5';document.getElementById('progressPercent').textContent=Math.round(p)+'%';window.scrollTo(0,0)}
function sel(e){const c=e.closest('.options');c.querySelectorAll('.option').forEach(o=>o.classList.remove('selected'));e.classList.add('selected')}
function pickWord(el){document.querySelectorAll('.drag-item').forEach(x=>x.classList.remove('selected'));el.classList.add('selected');selectedWord=el}
function dropWord(target){if(!selectedWord)return;target.textContent=selectedWord.dataset.w;target.classList.add('filled');target.dataset.d=selectedWord.dataset.w;selectedWord.style.display='none';selectedWord=null;document.querySelectorAll('.drag-item').forEach(x=>x.classList.remove('selected'))}
function updateWC(){document.getElementById('wordCount').textContent=document.getElementById('writingResponse').value.trim().split(/\s+/).filter(x=>x).length}
function submitS1(){let c=0;document.querySelectorAll('#section1 .options').forEach(o=>{const s=o.querySelector('.option.selected');if(s&&s.dataset.v===o.dataset.c)c++});sc.l=c;goTo(2)}
function submitS2(){let c=0;document.querySelectorAll('.drop-target').forEach(t=>{if(t.dataset.d===t.dataset.a)c++});sc.v=c;goTo(3)}
function submitWriting(){const t=document.getElementById('writingResponse').value.toLowerCase();const wc=t.trim().split(/\s+/).filter(x=>x).length;document.getElementById('writingLoading').classList.add('visible');setTimeout(()=>{const transWords=['bus','subway','train','car','drive','walk','bike','bicycle','taxi','uber','commute','traffic','station','metro','ride'];const foundTrans=transWords.filter(w=>t.includes(w)).length;const opinionMarkers=['i think','i believe','in my opinion','i prefer','i like','i dislike'];const foundOpinion=opinionMarkers.filter(w=>t.includes(w)).length;const hasLikeDislike=(t.includes('like')||t.includes('dislike')||t.includes('enjoy')||t.includes('hate'));let score=Math.min(8,foundTrans*2)+Math.min(6,foundOpinion*3)+(hasLikeDislike?2:0)+(wc>=50?4:wc>=30?2:0);sc.w=Math.min(20,score);document.getElementById('writingFeedback').innerHTML='<h4>Feedback</h4><p>Transportation words: '+foundTrans+'</p><p>Opinion phrases: '+foundOpinion+'</p><p>Word count: '+wc+'</p><p><strong>Score: '+sc.w+'/20</strong></p>';document.getElementById('writingLoading').classList.remove('visible');document.getElementById('writingFeedback').classList.add('visible');document.getElementById('writingSubmitBtn').style.display='none';document.getElementById('writingContinueBtn').style.display='inline-block'},1500)}
async function toggleRec(){if(!isRec){try{if(!navigator.mediaDevices)return alert('Browser not supported');document.getElementById('recordBtn').style.opacity='0.5';document.getElementById('recordingStatus').textContent='Requesting microphone...';const st=await navigator.mediaDevices.getUserMedia({audio:true});document.getElementById('recordBtn').style.opacity='1';mr=new MediaRecorder(st);ac=[];mr.ondataavailable=e=>ac.push(e.data);mr.onstop=()=>{document.getElementById('recordedAudio').src=URL.createObjectURL(new Blob(ac,{type:'audio/webm'}));document.getElementById('audioPlayback').classList.add('visible');document.getElementById('submitSpeakingBtn').disabled=false};mr.start();isRec=true;rs=0;document.getElementById('recordBtn').classList.add('recording');document.getElementById('recordingStatus').textContent='Recording... Click to stop';const SpeechRecognition=window.SpeechRecognition||window.webkitSpeechRecognition;if(SpeechRecognition){const recognition=new SpeechRecognition();recognition.continuous=true;recognition.interimResults=true;recognition.lang='en-US';recognition.onresult=(e)=>{let transcript='';for(let i=0;i<e.results.length;i++){transcript+=e.results[i][0].transcript}speechTranscript=transcript;document.getElementById('transcriptBox').textContent='üìù '+transcript;document.getElementById('transcriptBox').classList.add('visible')};recognition.onerror=(e)=>{console.log('Speech recognition error:',e.error)};recognition.start();window.currentRecognition=recognition}else{document.getElementById('transcriptBox').textContent='üìù Speech-to-text not supported in this browser. Your recording will still be submitted.';document.getElementById('transcriptBox').classList.add('visible')}ri=setInterval(()=>{rs++;document.getElementById('recordingTimer').textContent=Math.floor(rs/60)+':'+(rs%60).toString().padStart(2,'0')},1000)}catch(e){alert('Microphone error: '+e.message)}}else{mr.stop();mr.stream.getTracks().forEach(t=>t.stop());clearInterval(ri);isRec=false;if(window.currentRecognition)window.currentRecognition.stop();document.getElementById('recordBtn').classList.remove('recording');document.getElementById('recordingStatus').textContent='Recording saved!'}}
function submitSpeaking(){document.getElementById('speakingLoading').classList.add('visible');setTimeout(()=>{sc.s=rs>=30?20:rs>=20?15:rs>=10?10:5;document.getElementById('speakingFeedback').innerHTML='<h4>Feedback</h4><p>Duration: '+Math.floor(rs/60)+':'+(rs%60).toString().padStart(2,'0')+'</p><p><strong>Score: '+sc.s+'/20</strong></p>';document.getElementById('speakingLoading').classList.remove('visible');document.getElementById('speakingFeedback').classList.add('visible');goTo(5)},1500)}
function submitFinal(){let c=0;document.querySelectorAll('#section5 .options').forEach(o=>{const s=o.querySelector('.option.selected');if(s){if(s.dataset.v===o.dataset.c){c++;s.classList.add('correct')}else{s.classList.add('incorrect');o.querySelector('[data-v="'+o.dataset.c+'"]').classList.add('correct')}}});sc.g=c;const tot=sc.l+sc.v+sc.w+sc.s+sc.g,pct=Math.round((tot/57)*100);document.getElementById('finalScore').textContent=pct+'%';document.getElementById('scoreName').textContent=sn.split('[')[0].trim();document.getElementById('listeningScore').textContent=sc.l+'/3';document.getElementById('vocabScore').textContent=sc.v+'/6';document.getElementById('writingScore').textContent=sc.w+'/20';document.getElementById('speakingScore').textContent=sc.s+'/20';document.getElementById('grammarScore').textContent=sc.g+'/8';document.querySelectorAll('.section').forEach(x=>x.classList.remove('active'));document.getElementById('scoreSection').classList.add('active');document.getElementById('progressBar').style.display='none';window.scrollTo(0,0)}
function submitToTeacher(){const pct=Math.round((sc.l+sc.v+sc.w+sc.s+sc.g)/57*100);const writingText=document.getElementById('writingResponse').value||'No response';const transcript=speechTranscript||'[No transcript - Recording duration: '+Math.floor(rs/60)+':'+(rs%60).toString().padStart(2,'0')+']';const url='https://docs.google.com/forms/d/e/1FAIpQLSf9uEs5MqWLveyoaMBxeWx3pW1b90siwgaom766CpwqnOI7Dg/viewform?usp=pp_url&entry.518151516='+encodeURIComponent(sn)+'&entry.864654596='+encodeURIComponent(SESSION)+'&entry.258952242='+encodeURIComponent(sc.l+'/3')+'&entry.859150584='+encodeURIComponent(sc.v+'/6')+'&entry.939912807='+encodeURIComponent(writingText)+'&entry.1121796741='+encodeURIComponent(sc.w+'/20')+'&entry.2086302086='+encodeURIComponent(transcript)+'&entry.1435469716='+encodeURIComponent(sc.s+'/20')+'&entry.1998281944='+encodeURIComponent(sc.g+'/8')+'&entry.1207114914='+encodeURIComponent(pct+'%');document.getElementById('notSubmittedWarning').style.display='none';document.getElementById('submittedSuccess').style.display='block';document.getElementById('submitBtn').style.display='none';window.open(url,'_blank')}
</script>
</body>
</html>
